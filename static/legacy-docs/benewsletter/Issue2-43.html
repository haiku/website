<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Be Newsletters - Volume 2: 1997</title><link rel="stylesheet" href="be_newsletter.css" type="text/css" media="all" /><link rel="shortcut icon" type="image/vnd.microsoft.icon" href="./images/favicon.ico" /><!--[if IE]>
    <link rel="stylesheet" type="text/css" href="be_newsletter_ie.css" />
    <![endif]--><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Be Newsletters" /><link rel="up" href="volume2.html" title="Volume 2: 1997" /><link rel="prev" href="Issue2-42.html" title="Issue 2-42, October 22, 1997" /><link rel="next" href="Issue2-44.html" title="Issue 2-44, November 5, 1997" /></head><body><div id="header"><div id="headerT"><div id="headerTL"><a accesskey="p" href="Issue2-42.html" title="Issue 2-42, October 22, 1997"><img src="./images/navigation/prev.png" alt="Prev" /></a> <a accesskey="u" href="volume2.html" title="Volume 2: 1997"><img src="./images/navigation/up.png" alt="Up" /></a> <a accesskey="n" href="Issue2-44.html" title="Issue 2-44, November 5, 1997"><img src="./images/navigation/next.png" alt="Next" /></a></div><div id="headerTR"><div id="navigpeople"><a href="http://www.haiku-os.org"><img src="./images/People_24.png" alt="haiku-os.org" title="Visit The Haiku Website" /></a></div><div class="navighome" title="Home"><a accesskey="h" href="index.html"><img src="./images/navigation/home.png" alt="Home" /></a></div><div class="navigboxed" id="naviglang" title="English">en</div></div><div id="headerTC">Be Newsletters - Volume 2: 1997</div></div><div id="headerB">Prev: <a href="Issue2-42.html">Issue 2-42, October 22, 1997</a>  Up: <a href="volume2.html">Volume 2: 1997</a>  Next: <a href="Issue2-44.html">Issue 2-44, November 5, 1997</a></div><hr /></div><div class="article"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="Issue2-43"></a>Issue 2-43, October 29, 1997</h2></div></div></div><div class="sect1"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="Engineering2-43"></a>Be Engineering Insights: 3d Kit Tips And Hints</h2></div><div xmlns:d="http://docbook.org/ns/docbook"><span xmlns="http://www.w3.org/1999/xhtml" class="author">By <span class="firstname">Pierre</span> <span class="surname">Raynaud-Richard</span></span></div></div></div><p>
To judge from recent movie releases, Hollywood's two favorite subjects
are the President of the United States and aliens. The movie
"Independence Day" used both. But—can you believe it?—there were a
few technological "inconsistencies." The worst was the way David Levinson
(the Jeff Goldblum character) used a software virus to disable the shield
of the alien armada. Here's how Levinson *really* saved the world: He
found the proper function call. But let's back up a bit...
</p><p>
Did you really think that the alien detained in Area 51 was a mere
fighter pilot? No way! He was also a distinguished linguist, and a
high-level technologist. He spent years studying our languages,
especially English, and our technology, especially software engineering.
He found both of them so interesting that he couldn't resist writing his
own Fortran compiler (at the time, he had no real choice).
</p><p>
He even reimplemented his 3 billion native system calls so that he could
use Fortran to control his fighter. And because he loved our human
languages so much, he wrote the whole Fortran API in English, and also
used the advanced localization features of his OS so his Tracker would
display English text.
</p><p>
So what did Levinson really do? When he found the alien's navigation
system, he brought up the "Find Panel" and used it to search for the
keywords "disable" and "shield." And that's how he found a header file
defining the Fortran API...
</p><p>
INTEGER FUNCTION DISABLE_SHIELD(TARGET) INTEGER TARGET;
</p><p>
which accepted the values <code class="constant">K_FIGHTER</code>,
<code class="constant">K_MOTHER_SHIP</code>, and <code class="constant">K_ALL_ARMADA</code>. And
now you know the rest of the story. Stand by for news.
</p><div class="sect2"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="id596239"></a>Look in the Headers</h3></div></div></div><p>
The lesson from "Independence Day" is clear: If you know how to search
for information in header files, you can find a lot of good stuff. Such
is the case of the current alpha version of the 3d Kit, available at
ftp://ftp.be.com/pub/beos_updates/developers/3dKitAlpha.zip.
</p><p>
The sample code is good, but the commented headers are even better. The
only problem is that a lot of the 3d Kit API isn't as straightforward as
<code class="methodname">DISABLE_SHIELD()</code>. Although I can't explain the entire 3d Kit architecture
in a single article, I'll try to highlight a few obscure points.
</p></div><div class="sect2"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="id596267"></a>B3dCamera and Its "ViewPoint"</h3></div></div></div><p>
Why isn't the <code class="classname">B3dCamera</code> a <code class="classname">B3dThing</code>,
which lets you put it where you want
it in the world, and move it around the way you need to? That's an
interesting question that came up in BeDevTalk. The idea behind the
<code class="classname">B3dCamera</code> was to create a graphics engine to generate frames, rather than
simply give you a point of view in space. A <code class="classname">B3dCamera</code> encapsulates the
whole process used to look at the world. A camera's position and
orientation (in other words, its "thing"-ness) is certainly relevant
information, but it hardly scratches the surface of a <code class="classname">B3dCamera</code>.
</p><p>
In the <code class="classname">B3dCamera</code> class, the "viewpoint" is expressed (and can be
retrieved) as a <code class="classname">B3dThing</code>:
</p><pre class="programlisting cpp">
<span class="type"><code class="classname">B3dThing</code> *</span><code class="classname">B3dCamera</code>::<code class="methodname">ViewPoint</code>()
</pre><p>
You can let the <code class="classname">B3dCamera</code> create the
<code class="classname">B3dThing</code> viewpoint for you by
specifying the location of the viewpoint:
</p><pre class="programlisting cpp">
<span class="type">void</span> <code class="classname">B3dCamera</code>::<code class="methodname">SetViewPoint</code>(<code class="classname">B3dVector</code> <code class="parameter">originInWorldSpace</code>,
                             <span class="type"><code class="classname">B3dWorld</code> *</span><code class="parameter">world</code>)
</pre><p>
Or you can "attach" your camera's viewpoint to some other existing thing:
</p><pre class="programlisting cpp">
<span class="type">int32</span> <code class="classname">B3dCamera</code>::<code class="methodname">SetViewPoint</code>(<span class="type"><code class="classname">B3dThing</code> *</span><code class="parameter">view_point</code>)
</pre><p>
The latter method lets you see the world through the "eyes" of the other
"thing" you've attached it to. Where the thing goes, your camera goes.
</p></div><div class="sect2"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="id596418"></a>B3dLink</h3></div></div></div><p>
<code class="classname">B3dLink</code> may be one of the most problematic concepts in the 3d Kit—not
because it's complex, but because its name and API are too simple to
reveal any information about it.
</p><p>
<code class="classname">B3dLink</code> provides a model that describes the relationships between
<code class="classname">B3dThing</code> objects as a graph of master/slave dependencies, where the state
of a slave object (its position and orientation, primarily) depends on
the states of a variable number of master objects. The state of the slave
can also depend on the flow of time.
</p><p>
For example, you can "glue" two objects together so they always stay a
certain distance apart. Or you can describe the trajectory that a thing
should follow as a <code class="classname">B3dLink</code> that respects the flow of time, but that has
no master objects.
</p><p>
The <code class="classname">B3dLink</code> mechanism can be predicated on almost anything: You aren't
limited to only the state of the master objects and the flow of time. For
example, let's say you want to have an object flying around "following" a
music sound track. Just create a <code class="classname">B3dLink</code> subclass that periodically
checks the global state of your music system and off you go.
</p><p>
Another feature of <code class="classname">B3dLink</code> is that it lets you "relink" on the fly. You
just have to call
</p><pre class="programlisting cpp">
<span class="type">int32</span> <code class="classname">B3dThing</code>::<code class="methodname">LinkTo</code>(<span class="type"><code class="classname">B3dLink</code> *</span><code class="parameter">link</code>, <span class="type">ulong</span> <code class="parameter">mode</code> =
                       <code class="constant">B_CHECK_CYCLE</code>)
</pre><p>
<code class="methodname">LinkTo()</code> unlinks and destroys the
<code class="classname">B3dLink</code> object that's currently
controlling your object and makes your object a slave of the new link. If
you simply want to unlink without relinking, you call:
</p><pre class="programlisting cpp">
<span class="type">int32</span> <code class="classname">B3dThing</code>::<code class="methodname">Unlink</code>(<span class="type">ulong</span> <code class="parameter">mode</code> = 0L)
</pre><p>
Be careful though, because the thing's <code class="classname">B3dLink</code> object is destroyed when
you unlink it. This means that you can't "temporarily" unlink an object
(i.e., unlink, move the object, relink). If you have to do that, you've
chosen the wrong kind of <code class="classname">B3dLink</code>. A properly designed link integrates all
the control you need to move your object.
</p><p>
Another way to modify the state of something at every frame is to use a
"frame hook." Frame hooks aren't as nice as links, so you should avoid
them, but they may be necessary in some cases (for example, the
<code class="classname">B3dCinepakChannel</code> uses a frame hook to synchronize the update of new
frames). The API is in <code class="filename">B3dUniverse.h</code>.
Check the 3dmov sample code for
more info.
</p></div><div class="sect2"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="id596598"></a>Groups</h3></div></div></div><p>
Groups are the offspring of links and hierarchy. If you want to package a
small number of <code class="classname">B3dThing</code>s together and handle them as a single object,
use a group. This implies a relationship between the "main" object that
represents the group (the "group master") and all the group members.
</p><p>
That's where the <code class="classname">B3dLink</code> comes in. Every member of a group has to be
linked (directly or through the link hierarchy) to the group master. If
you've already defined <code class="classname">B3dLink</code>s between some members of the group, only
those members that don't already have a master will be directly linked to
the group master. The nature of the link is defined by some bits in the
"mode" flag in the <code class="function">group_things()</code> function:
</p><pre class="programlisting cpp">
<span class="type">long</span> <code class="function">group_things</code>(<span class="type">long</span> <code class="parameter">count</code>,
                  <span class="type"><code class="classname">B3dThing</code> **</span><code class="parameter">list</code>,
                  <span class="type"><code class="classname">B3dThing</code> **</span><code class="parameter">group</code>,
                  <span class="type">char *</span><code class="parameter">name</code>,
                  <span class="type"><code class="classname">B3dVector</code> *</span><code class="parameter">origin</code> = 0L,
                  <span class="type">float</span> <code class="parameter">threshold</code> = -1.0,
                  <span class="type">ulong</span> <code class="parameter">mode</code> = <code class="constant">B_EXTEND_GROUP</code> |
                               <code class="constant">B_RIGID_LINK</code> |
                               <code class="constant">B_CHECK_CYCLE</code>);
</pre><p>
In the default case, everything is linked "rigidly." That is, all members
keep the same position relative to the group master. Once a group has
been created, all interactions with it should be done only through the
group master. Internal <code class="classname">B3dLink</code>s will still work, but you won't be able to
link a group member to an object outside the group.
</p><p>
See <code class="filename">B3dThing.h</code> and
<code class="filename">B3dLink.h</code> for more details.
</p></div><div class="sect2"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="id596748"></a>The Z-Buffer and Anti-Aliased Bitmaps</h3></div></div></div><p>
If you're just playing with simple objects that don't touch each another,
the rendering engine's default sorting mode should be sufficient. But if
you want to go beyond that—and especially if you want to have objects
touching one another—you need to enable the "depth buffer" (or
"Z-Buffer"). For now, the Z-buffer has to be enabled at the graphic
buffer level, directly in the <code class="classname">B3dView</code> constructor:
</p><pre class="programlisting cpp">
<code class="classname">B3dView</code>::<code class="methodname">B3dView</code>(<span class="type">char *</span><code class="parameter">name</code>,
                 <code class="classname">BRect</code> <code class="parameter">frame</code>,
                 <span class="type"><code class="classname">B3dUniverse</code> *</span><code class="parameter">universe</code> = <code class="constant">NULL</code>,
                 <span class="type">uint32</span> <code class="parameter">renderFlags</code> = <code class="constant">B_3D_BLACK_BACKGROUND</code>)
</pre><p>
The values for <code class="varname">renderFlags</code> are described over in
<code class="filename">3dDefs.h</code>, so finding
them is a bit confusing. Although you almost always need
<code class="constant">B_3D_BLACK_BACKGROUND</code> to erase the buffer to black before each new frame,
if you know for sure that your 3D rendering will redraw every pixel in
the frame (for example, if you're using an "environment thing," as
explained below), you can disable it and save a bit of computation. The
two other options are <code class="constant">B_3D_ZBUFFER</code> to enable the depth buffer and
<code class="constant">B_3D_ANTIALIAS_TEXTURES</code> to enable anti-aliasing for texture mapping.
Anti-aliasing (in particular) slows things down quite a bit, but it
certainly looks much nicer, especially if you zoom in very close on a
texture.
</p></div><div class="sect2"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="id596856"></a>Fake Backgound Objects and Environment Objects</h3></div></div></div><p>
You can do another <code class="filename">3dThing.h</code> trick
with the flags <code class="constant">B_BACKGROUND_THING</code> and
<code class="constant">B_ENVIRONMENT_THING</code>. You set them after construction using the following
API...
</p><pre class="programlisting cpp">
inline <span class="type">ulong</span> <code class="classname">B3dThing</code>::<code class="methodname">Properties</code>()
<span class="type">void</span> <code class="classname">B3dThing</code>::<code class="methodname">SetProperties</code>(<span class="type">ulong</span> <code class="parameter">mode</code>)
</pre><p>
...using calls that look like this:
</p><pre class="programlisting cpp">
<code class="varname">thing</code>-&gt;<code class="methodname">SetProperties</code>(<code class="varname">thing</code>-&gt;<code class="methodname">Properties</code>() |
                     <code class="constant">B_BACKGROUND_THING</code>);
</pre><p>
The "background thing" and "environment thing" properties are ugly hacks
that let you fake a couple of features that aren't currently supported by
the 3d Kit.
</p><p>
A real background object would be something huge and static (like the
future <code class="classname">B3dClosedWorld</code>, discussed in the 3d Kit white paper,
http://www.be.com/developers/3DWhitePaper.html) that would represent the
"scene" in which other moving objects would evolve. You would be able to
go around the background, below it, behind it, and so on, without using
the depth buffer, and with more potential optimizations.
</p><p>
For now, though, the real thing doesn't exist. If you want to simulate a
background object without having to use the depth buffer, just set the
<code class="constant">B_BACKGROUND_THING</code> flag for the background object, and it will always be
drawn before any other thing that doesn't have <code class="constant">B_BACKGROUND_THING</code> set.
It's ugly...but it works (the butterfly demo uses this trick for the
temple).
</p><p>
An environment thing is an object that you want always to be visible in
the distance. A thing that's set to <code class="constant">B_ENVIRONMENT_THING</code> is always drawn
first—even before the <code class="constant">B_BACKGROUND_THING</code> things. An environment thing
is affected by the camera's rotation, but not by the camera's linear
movement (its "translation"). Whatever the real size of an environment
thing is, it's considered to be so big and so far away that no
translation of the ViewPoint of the camera can affect the way you see it,
which is a good approximation of a distant environment.
</p><p>
For example, you can create a reversed sphere (i.e., seen from the
center), onto which you've mapped a spherical view of your environment.
When you put it in your world and set <code class="constant">B_ENVIRONMENT_THING</code>, the camera
will always see it from its center, properly rotated and never moved.
Even if it's closer than some object, it's always drawn first, so it
appears to be behind everything else. If you use both a depth buffer and
the <code class="constant">B_ENVIRONMENT_THING</code> flag, it's best to use a big radius for the
sphere, or you could get a nasty surprise. :-)
</p></div><div class="sect2"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="id597024"></a>Importing Models</h3></div></div></div><p>
We support VRML 1.0 reasonably well, but who knows how well everybody
(including Be) is respecting this format? If you want to create
complicted shapes using a CAD program, it's probably the best way. But if
you want to generate a shape using your own code (or your own CAD
application), and you don't want to write/integrate a VRML exporter, an
easy way to do it is to use the raw <code class="filename">teapot.data</code> format. It's a trivial
format (check <code class="filename">/boot/beos/etc/teapot.data</code> for an example):
</p><pre class="screen">
PointCount X0 Y0 Z0 NX0 NY0 NZ0 ... Xn Yn Zn NXn NYn Nzn

FaceCount A0 B0 C0 ... Am Bm Cm
</pre><p>
The first list describes the list of points (PointCount = n+1, from 0 to
n). Xn, Yn and Zn are the coordinates of each point; NXn, NYn, NZn are
the coordinates of the normal vector of the shape in this point.
</p><p>
The second list is the list of triangles (FaceCount = m+1, from 0 to m),
where An, Bn and Cn are the indices of the 3 points in the point list,
going clockwise around the triangle.
</p><p>
Those are your 3d Kit tips for now. More would be better, but I hope
these will be of some help to you. On behalf of everyone who has been
working on the 3d Kit, I would like to thank all the developers that have
used the 3d Kit, especially for sending us feedback, questions, and bug
reports. We know it's not finished yet, but whenever I have a few days to
create new demos (before a trade-show or a developer conference), I don't
regret the work we've put into it.
</p></div></div><hr class="pagebreak" /><div class="sect1"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="News2-43"></a>News From The Front</h2></div><div xmlns:d="http://docbook.org/ns/docbook"><span xmlns="http://www.w3.org/1999/xhtml" class="author">By <span class="firstname">William</span> <span class="surname">Adams</span></span></div></div></div><p>
It's hard to believe, but this marks my 53rd newsletter article since
joining Be. When I joined Be, I immediately asked for newsletter duty,
because I was so excited by the opportunities that lay ahead, and I
wanted to spread my enthusiasm. In my 53 articles, I hope that I have
helped a lot of new developers to understand, and become enthusiastic
about, the BeOS.
</p><p>
This article marks a turning point in my career at Be. Before joining Be
I was intensely committed to engineering. But I was a bit burned out on
it, and for awhile I just wanted to help other developers write apps.
Having a child encouraged me into a helping mode as well.
</p><p>
Now, after a year as a Be evangelist, I am returning to writing code on a
regular basis. As a member of the engineering group I will be working on
projects that I hope will further the prospects of Be and continue to
help developers take advantage of this most awesome OS.
</p><p>
From now on, I'll be writing articles in rotation with other engineers.
So this is the last installment of "From The Front."
</p><p>
In the future, you'll be seeing more articles written by our DTS staff
and tech writers. They'll bring you good news and articles full of
wisdom. Their topics will come from suggestions made by our end-users and
developers. That means YOU.
</p><p>
If you have suggestions, go to our web page and fill out the form for
suggested topics (see the next article for the URL). We'll try to address
as many of them as we can in a timely manner.
</p><p>
Although I'll no longer be in your face on a weekly basis, you'll no
doubt still hear from me. I'm full of excitement about the BeOS, and I'm
looking to infect more converts, so I'll be there. As I'm always fond of
saying "There you have it." I'll see you at the front.
</p></div><hr class="pagebreak" /><div class="sect1"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="DevWorkshop2-43"></a>Developers' Workshop: Fork(), Spawn_thread(), And The Beos</h2></div><div xmlns:d="http://docbook.org/ns/docbook"><span xmlns="http://www.w3.org/1999/xhtml" class="author">By <span class="firstname">Doug</span> <span class="surname">Fulton</span></span></div></div></div><p>
This issue of the Be Newsletter introduces "Developers' Workshop," a new
weekly feature that provides answers to our developers' questions. Each
week, a Be technical support or documentation professional will choose a
question (or two) sent in by an actual developer and provide an answer.
</p><p>
How different is this from the regular Engineering Insights columns? In
content, probably not a whole lot—you'll see source code, pointers to
fuller examples on the Web site, and get tips and suggestions from the
horse's mouth. Beyond that, the column is an opportunity for the
documentation folks to go into greater detail on certain subjects, and
for the tech supporters to speak to a wider audience.
</p><p>
But the biggest "Developers' Workshop" difference is this: You get to ask
the questions. Here's how:
</p><p>
We've created a new section on our web site. Please send us your
Newsletter topic suggestions by visiting the web site at:
http://www.be.com/developers/suggestion_box.html.
</p><p>
Send us your questions, and we'll use them as fodder for this column and
for the Engineering Insights, as well. Today we'll dispel a rumor and
visit an old friend.
</p><p>
An issue that's been bugging a few of our developers involves a statement
made in the Kernel Kit chapter of the Be Book. Turn to hymn #105:
</p><p>
“<span class="quote">Threads and the POSIX <code class="function">fork()</code> function are not compatible... If you call
<code class="function">spawn_thread()</code> and then try to call
<code class="function">fork()</code>, the <code class="function">fork()</code> call will fail.
And vice versa.</span>”
</p><p>
Is it really so? Well, not exactly...if you call <code class="function">fork()</code> from thread land,
the call won't fail, but you may be asking for trouble. The <code class="function">fork()</code>'d
process inherits global data from the "parent" team. Unlike a spawned
thread, however, the data isn't shared between the processes: It's
copy-on-write. This means that the child can *see* the parent's be_app
object and all its <code class="classname">BWindows</code> (as examples), but it can't do anything with
them. The child can't lock be_app, or send it a message, or talk to the
windows. Even lower-level resources, such as semaphores and ports, are
off limits (they're also copy-on-write). The forked process can't do
anything "team-like."
</p><p>
So why would anyone be tempted to fork from within a threaded Be
application? A nearly justifiable answer (and the only one that anyone
around here can think of) is that it's because they're porting an
existing chunk of code that they want to drop into a Be application
framework. If this sounds like you, you have a couple of options, but
only one of them makes sense. Let's start from scratch:
</p><p>
Go ahead and try porting your forking code. The code that's executed in
the forked thread can only make POSIX calls, but since this is ported
code, you won't be invoking "sensitive" global entities (such as be_app
or semaphores) anyway. But are even the POSIX calls safe? Nope...<code class="function">exit()</code>,
for one, is a killer. If the child calls <code class="function">exit()</code>, the game is over. There
may be other POSIX calls that are deadly—running through the suite in
the context of a multi-threaded app isn't a priority in the testing lab.
</p><p>
Okay, so <code class="function">exit()</code> is out, and other POSIX calls might be dangerous. What's
safe? The only (reasonably) reliable call is <code class="function">exec()</code> (and its brethren).
Typically, this is why you're forking in the first place. A fork setup is
usually an expanded version of this:
</p><pre class="programlisting c">
<span class="type">int</span> <code class="varname">pid</code>;
<span class="type">char *</span><code class="varname">args</code>[2];
<code class="varname">args</code>[0] = <code class="function">strdup</code>("Clock");
<code class="varname">args</code>[1] = <code class="constant">NULL</code>;

if ((<code class="varname">pid</code>=<code class="function">fork</code>()) == 0)
  <code class="function">execv</code>("Clock", <code class="varname">args</code>);
</pre><p>
But if you've come this far—if you're forking just to get another team
running—you might as well rewrite the code to use the Kernel Kit's
<code class="function">load_image()</code>:
</p><pre class="programlisting cpp">
<span class="type">thread_id</span> <code class="function">load_image</code>(<span class="type">int32</span> <code class="parameter">argc</code>, <span class="type">const char **</span><code class="parameter">argv</code>,
                     <span class="type">const char **</span><code class="parameter">env</code>)
</pre><p>
You have to supply an initial argument count and environment variable
array (which you can pick up for free by extern'ing the global environ
variable), but otherwise the <code class="function">load_image()</code> call can be swapped in for the
<code class="function">fork()</code>/<code class="function">execv()</code> calls. The new team inherits file descriptors from the
caller, so you don't have to rewrite your pipe code. Here's what it looks
like:
</p><pre class="programlisting c">
<span class="comment">/* Declare the environ array. */</span>
extern <span class="type">char **</span><code class="parameter">environ</code>;

<span class="type">thread_id</span> <code class="varname">thread</code>;
<span class="type">char *</span><code class="varname">args</code>[2];
<code class="varname">args</code>[0] = <code class="function">strdup</code>("Clock");
<code class="varname">args</code>[1] = <code class="constant">NULL</code>;

<code class="varname">thread</code> = <code class="function">load_image</code>(2, <code class="varname">args</code>, <code class="varname">environ</code>);
</pre><p>
Given the caveats surrounding
<code class="function">fork()</code>
and the ease with which you can trade in your
<code class="function">fork()</code>/<code class="function">execv()</code>'s for a
shiny new <code class="function">load_image()</code>, there's not much reason to force square pids into
round threads.
</p><p>
Don't be confused: The BeOS implementation of <code class="function">fork()</code> is prefectly
healthy. If you're porting a program that's pure POSIX, go ahead and
<code class="function">fork()</code>; it will work today, it will work tomorrow. But as soon as you
introduce shared resources into your app—the type of resources that
you can share between spawned threads—you're living on borrowed cycles.
</p></div><hr class="pagebreak" /><div class="sect1"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="Gassee2-43"></a>The Substance of the DOJ Complaint Against Microsoft</h2></div><div xmlns:d="http://docbook.org/ns/docbook"><span xmlns="http://www.w3.org/1999/xhtml" class="author">By <span class="firstname">Jean-Louis</span> <span class="surname">Gassée</span></span></div></div></div><p>
I write the word substance with intent, as I'd like to separate common
sense from the law, and sentiment from colder prognosis.
</p><p>
We can read the DOJ filing, at:
</p><p>
<a class="ulink" href="http://www.usdoj.gov/atr/cases3/micros2/1237.htm">http://www.usdoj.gov/atr/cases3/micros2/1237.htm</a>
</p><p>
...the original 1995 "Consent Decree" on which the current complaint is
based, at:
</p><p>
<a class="ulink" href="http://www.usdoj.gov/atr/cases3/micros0/0047.htm">http://www.usdoj.gov/atr/cases3/micros0/0047.htm</a>
</p><p>
...and Microsoft's first official response at:
</p><p>
<a class="ulink" href="http://www.microsoft.com/corpinfo/doj/dojletter.htm">http://www.microsoft.com/corpinfo/doj/dojletter.htm</a>
</p><p>
My associates shake their heads and tell me reading legal briefs is
decidedly an acquired taste. What can I say, I love US law. Ascribe my
deviant enthusiasm to the stronger loyalty often exhibited by new
immigrants.
</p><p>
On the legal front, I see four questions: Who defines what can and cannot
go into an operating system; is Explorer bundled with Windows in
violation of the Consent Decree; did Microsoft use strong arm tactics in
violation of the Consent Decree; and does Microsoft's NDA goes too far in
preventing OEMs from airing their grievances.
</p><p>
I'll skip the last one, it's peripheral to the more important issues and
Microsoft has already conceded they didn't "mean" for the NDA to apply to
Federal investigations.
</p><p>
Did Microsoft use strong-arm tactics in violation of the law or the terms
of the Consent Decree? Possibly, but in a way, such behavior is
subordinated to the bigger issue of bundling.
</p><p>
And, of course, we don't want the government to tell us which lines of
C++ code belong to the OS and which ones belong to the application.
That's not the central legal issue. The real question is whether or not,
in the eye of the law, Explorer is a separated product or an extension of
Windows.
</p><p>
Microsoft says Explorer is a system extension, while the DOJ points out
Microsoft offered and continues to offer it as a separate product. This
is true, buy Microsoft's Money 98 and it ships with a copy of Explorer.
</p><p>
As a result of their licensing agreement with Microsoft, OEMs cannot
alter Windows at will. This is the lever Microsoft is accused of pulling
against Netscape. Don't delete Explorer, it is a part of Windows. The DOJ
views Explorer as a separate application and accuses Microsoft of using
the integration pretense as a way to make impossible for OEMs to remove
Explorer and install Navigator instead. To which Microsoft rightly
retorts they must keep Explorer and they can install Navigator as well.
</p><p>
Can a software product be a separate application in some cases and part
of the system in some others? What about modular systems? The legal
discussion is guaranteed to be involved and I have no idea which way the
legal razor will cut this issue.
</p><p>
On the common sense front, the situation is ripe with ironies. For
instance, I wonder if OEMs are allowed to pick and choose which drivers
(graphics cards, network adapters) they install on the system they ship.
I believe they actually perform such modifications of the system.
</p><p>
Legal contortions aside, is adding or removing a driver from the system
distribution much different from removing Explorer? Microsoft says they
want Windows unmodified because they're concerned about the quality of
the user's experience. At the same time, Microsoft claims the right to
alter Java almost any way they like. Again, they might be right in their
reading of their Java license agreement (read their countersuit at
<a class="ulink" href="http://www.microsoft.com/corpinfo/java/java2.htm">http://www.microsoft.com/corpinfo/java/java2.htm</a>), but the public
perception might be negative.
</p><p>
Speaking of ironies, when Windows 98 ships, the bundling issue will
become moot unless Microsoft decides the system needs to ship with more
and better functions, such a shell for Microsoft Office applications
guaranteeing users a cleaner, better integrated set of office
productivity solutions.
</p></div></div><div id="footer"><hr /><div id="footerT">Prev: <a href="Issue2-42.html">Issue 2-42, October 22, 1997</a>  Up: <a href="volume2.html">Volume 2: 1997</a>  Next: <a href="Issue2-44.html">Issue 2-44, November 5, 1997</a> </div><div id="footerB"><div id="footerBL"><a href="Issue2-42.html" title="Issue 2-42, October 22, 1997"><img src="./images/navigation/prev.png" alt="Prev" /></a> <a href="volume2.html" title="Volume 2: 1997"><img src="./images/navigation/up.png" alt="Up" /></a> <a href="Issue2-44.html" title="Issue 2-44, November 5, 1997"><img src="./images/navigation/next.png" alt="Next" /></a></div><div id="footerBR"><div><a href="http://www.haiku-os.org"><img src="./images/People_24.png" alt="haiku-os.org" title="Visit The Haiku Website" /></a></div><div class="navighome" title="Home"><a accesskey="h" href="index.html"><img src="./images/navigation/home.png" alt="Home" /></a></div></div><div id="footerBC"><a href="http://www.access-company.com/home.html" title="ACCESS Co."><img alt="Access Company" src="./images/access_logo.png" /></a></div></div></div><div id="licenseFooter"><div id="licenseFooterBL"><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/" title="Creative Commons License"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-nd/3.0/88x31.png" /></a></div><div id="licenseFooterBR"><a href="./LegalNotice.html">Legal Notice</a></div><div id="licenseFooterBC"><span id="licenseText">This work is licensed under a
          <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative
          Commons Attribution-Non commercial-No Derivative Works 3.0 License</a>.</span></div></div></body></html>
