<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Be Newsletters - Volume 4: 1999</title><link rel="stylesheet" href="be_newsletter.css" type="text/css" media="all" /><link rel="shortcut icon" type="image/vnd.microsoft.icon" href="./images/favicon.ico" /><!--[if IE]>
    <link rel="stylesheet" type="text/css" href="be_newsletter_ie.css" />
    <![endif]--><meta name="generator" content="DocBook XSL Stylesheets V1.73.2" /><link rel="start" href="index.html" title="Be Newsletters" /><link rel="up" href="volume4.html" title="Volume 4: 1999" /><link rel="prev" href="Issue4-8.html" title="Issue 4-8, February 24, 1999" /><link rel="next" href="Issue4-10.html" title="Issue 4-10, March 10, 1999" /></head><body><div id="header"><div id="headerT"><div id="headerTL"><a accesskey="p" href="Issue4-8.html" title="Issue 4-8, February 24, 1999"><img src="./images/navigation/prev.png" alt="Prev" /></a> <a accesskey="u" href="volume4.html" title="Volume 4: 1999"><img src="./images/navigation/up.png" alt="Up" /></a> <a accesskey="n" href="Issue4-10.html" title="Issue 4-10, March 10, 1999"><img src="./images/navigation/next.png" alt="Next" /></a></div><div id="headerTR"><div id="navigpeople"><a href="http://www.haiku-os.org"><img src="./images/People_24.png" alt="haiku-os.org" title="Visit The Haiku Website" /></a></div><div class="navighome" title="Home"><a accesskey="h" href="index.html"><img src="./images/navigation/home.png" alt="Home" /></a></div><div class="navigboxed" id="naviglang" title="English">en</div></div><div id="headerTC">Be Newsletters - Volume 4: 1999</div></div><div id="headerB">Prev: <a href="Issue4-8.html">Issue 4-8, February 24, 1999</a>  Up: <a href="volume4.html">Volume 4: 1999</a>  Next: <a href="Issue4-10.html">Issue 4-10, March 10, 1999</a></div><hr /></div><div class="article"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="Issue4-9"></a>Issue 4-9, March 3, 1999</h2></div></div></div><div class="sect1"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="Engineering4-9"></a>Be Engineering Insights: NetPositive Q&amp;A</h2></div><div xmlns:d="http://docbook.org/ns/docbook"><span xmlns="http://www.w3.org/1999/xhtml" class="author">By <span class="firstname">Scott</span> <span class="surname">Barta</span></span></div></div></div><p>
Whenever I make an appearance on one of the Be user mailing lists, I
usually get peppered with questions from the curious about <span class="application">NetPositive</span>.
Many of these questions have common themes, so I thought I'd answer a
number of them here.
</p><div class="qandaset"><table border="0" summary="Q and A Set"><col align="left" width="1%" /><tbody><tr class="question"><td><a id="id767638"></a><a id="id767640"></a>Q:</td><td><p>
When is JavaScript going to be implemented?
</p></td></tr><tr class="answer"><td align="left" valign="top">A:</td><td align="left" valign="top"><p>
JavaScript support is my main project right now (aside from getting
R4.1 out the door, of course). You can get a very early developer release
of JavaScript- capable NetPositive right now at
http://www.be.com/support/updates/r4_netpositive_3.html. The mainline
browser in R4.1 will not be JavaScript-enabled, though a 3.0
developmental version will likely ship in the experimental folder on the
CD.
</p><p>
For those who downloaded 3.0d1 and were less than impressed, a much-
improved 3.0d2 is now available at the <acronym class="acronym">URL</acronym> above. JavaScript will be
shaping up over the next few months, and we'll continue to release new
versions as it makes sense to do so.
</p></td></tr><tr class="question"><td><a id="id767669"></a><a id="id767672"></a>Q:</td><td><p>
How about Java?
</p></td></tr><tr class="answer"><td align="left" valign="top">A:</td><td align="left" valign="top"><p>
First, please understand that JavaScript has nothing at all to do with
Java, despite the similarity of names. For more details, please see the
ReadMe that installs with the developer release at the URL above. For
Java to work in the browser, there needs to be a Java
<acronym class="acronym" title="Virtual Machine">VM</acronym> and
<acronym class="acronym" title="Abstract Windowing Toolkit">AWT</acronym>
implementation for the BeOS; none currently exist.
</p><p>
We've looked into bringing Java into the fold, and at various times there
has been rudimentary Java support for the BeOS, but never anything that
was very useful.
</p><p>
Unfortunately, getting a decent Java implementation on the BeOS requires
a lot of engineering resources that we don't have, so there isn't
anything on the drawing board yet. A number of third parties are working
on Java for the BeOS, but I don't know the exact status of any of those
projects. It's my general understanding that getting the
<acronym class="acronym">VM</acronym> working isn't the hard part; the <acronym class="acronym">AWT</acronym>
and class libraries are extremely tough, especially if you're independent from Sun.
</p></td></tr><tr class="question"><td><a id="id767725"></a><a id="id767728"></a>Q:</td><td><p>
Will NetPositive allow plug-ins?
</p></td></tr><tr class="answer"><td align="left" valign="top">A:</td><td align="left" valign="top"><p>
<span class="application">NetPositive</span> has a decreased reliance on plug-ins compared to other
browsers, because a lot of the technologies that other browsers implement
this way can be done with more BeOS-specific paradigms. For example, R4.1
will add <acronym class="acronym">PNG</acronym> image support, courtesy of the Translation Kit and the new
<acronym class="acronym">PNG</acronym> add-on; and in the future, as streaming media nodes are written, the
addition of Media Kit support to <span class="application">NetPositive</span> will bring in those data
types "for free." With that said, though, there are still a lot of
situations which call for plug-ins, and I'm hoping to add plug-in support
in cooperation with the folks working on <span class="application">Opera</span>
and <span class="application">BeZilla</span>. One of my
goals is to expand plug-in support beyond the simple model that Netscape
and <span class="application">Internet Explorer</span> use, and to allow new kinds of plug-ins to interact
with the browser in new and mysterious ways.
</p></td></tr><tr class="question"><td><a id="id767778"></a><a id="id767780"></a>Q:</td><td><p>
What's up with the haiku error messages?
</p></td></tr><tr class="answer"><td align="left" valign="top">A:</td><td align="left" valign="top"><p>
The haiku error messages are responsible for a surprising amount of
user feedback, which has been overwhelmingly (but not entirely) positive.
I think it has to do with the fact that despite their fancy GUIs,
computers have lately become somewhat impersonal, with their interfaces
endlessly focus-grouped and graphic-designer-polished, and users are
grasping at anything that adds a human touch, if a somewhat quirky one.
Like many human touches, though, the haiku tend to anger some,
particularly those who have seen <span class="application">NetPositive</span> spectacularly fail to deal
with yet another site. For that reason, and also for the non-native
speakers of English, there will be a preference in R4.1 to turn the haiku
off. There's a secret preference to do this in R4; see the BeOS Tip
Server at http://www.birdhouse.org/beos/tips/archive/tip235.html for
details.
</p><p>
Be warned, though—if you're expecting to get more informative error
messages with the haiku turned off, you're going to be disappointed,
because the messages that the haiku replace are (and always were) rather
bland. There are very few kinds of errors that <span class="application">NetPositive</span> displays in an
error dialog, and for all of those, there is little information that
NetPositive could possibly give that would be of any help. In virtually
all cases, the haiku that you see replace one of two error messages, the
first being "The web server www.blah.com could not be found" and the
second, "The web server www.blah.com is temporarily down. Please try
again later." The distinction between these two errors is important,
because it will tell you if you've mistyped the hostname (unless you've
mistyped the name of a popular site like www.yahoo.com, whereupon you're
likely to come across one of the Net's several "adult" sites), or if the
server is dead. Actually, <span class="application">NetPositive</span> chooses from different sets of
haiku for each type of error, and if you interpret the poem, you'll
figure out what happened.
</p><p>
For nearly every other type of error condition, the error message you see
is actually an error page that is sent back from the server which
NetPositive has no control over and displays as-is regardless of the
haiku setting. So, the addition of haiku does not significantly mask
information that other browsers would give you; if you like them, leave
them turned on.
</p></td></tr><tr class="question"><td><a id="id767827"></a><a id="id767829"></a>Q:</td><td><p>
Can you add the XYZ feature to help page designers author better pages?
</p></td></tr><tr class="answer"><td align="left" valign="top">A:</td><td align="left" valign="top"><p>
I think some of the flap over haiku comes from people who would like
to use <span class="application">NetPositive</span> to help them author web sites, and would like to get
more detailed error information when something goes wrong. They think
that <span class="application">NetPositive</span> is ignoring error information it could be giving and is
deciding to be cute instead.
</p><p>
The error information that page designers want would take the form of
detailed, verbose error reporting from the <acronym class="acronym">HTTP</acronym> level (which would be
very helpful in diagnosing a variety of redirection and cookie problems),
as well as some sort of "strict" <acronym class="acronym">HTML</acronym> parsing mode that would reject
illegal <acronym class="acronym">HTML</acronym> with an error message.
</p><p>
Unfortunately, this sort of error information usually isn't available in
great detail from any browser, and in most cases isn't appropriate or
interesting for the general browser user. While site designers are very
interested in knowing what went wrong in the delicate interaction of
<acronym class="acronym">CGI</acronym>s, redirection, caching, proxies, cookies, frames, <acronym class="acronym">HTML</acronym>, and
JavaScript that made their site not work, most users don't want to be
bothered with the gory details. Since it would require so much work to
implement well and would only benefit a small fraction of users, it isn't
something that makes sense to do in <span class="application">NetPositive</span> in the near future. It's
unfortunate, though, because this is an important if small market that
isn't being served well by any tools that I'm aware of.
</p><p>
There is one small diagnostic tool you can use, though; if you run
<span class="application">NetPositive</span> from the command line and
give it the   --dump  option, it will
dump the contents of all net transactions to the terminal. This isn't a
supported feature of the browser, so please don't rely on its being there
or write up bugs against it (particularly since it doesn't work
perfectly), but you may find it useful. Also, please be aware that it
will dump the data from
<acronym class="acronym" title="Secure Sockets Layer">SSL</acronym> connections in the clear (though the network
connection itself is still of course encrypted), so there is a slight
security risk involved.
</p></td></tr><tr class="question"><td><a id="id767929"></a><a id="id767931"></a>Q:</td><td><p>
How can I tell a <span class="application">NetPositive</span> window to open a URL?
</p></td></tr><tr class="answer"><td align="left" valign="top">A:</td><td align="left" valign="top"><p>
<code class="filename">/boot/develop/headers/be/be_apps/NetPositive/NetPositive.h</code> describes a
set of <code class="classname">BMessage</code>s that you can send to <span class="application">NetPositive</span> windows or Replicant
views to have them load <acronym class="acronym">URL</acronym>s. You can obtain a reference to a window in a
running instance of <span class="application">NetPositive</span> through the normal scripting mechanisms.
In the future, <span class="application">NetPositive</span> will have a more complete scripting solution,
but for now, this should satisfy the needs of many developers. Keep an
eye on this file; it will describe any public <acronym class="acronym">API</acronym>s that are added to
<span class="application">NetPositive</span> in the future.
</p></td></tr><tr class="question"><td><a id="id767985"></a><a id="id767988"></a>Q:</td><td><p>
What is the NetPositive Replicant format?
</p></td></tr><tr class="answer"><td align="left" valign="top">A:</td><td align="left" valign="top"><p>
The best way to figure it out is to create a <code class="classname">BShelf</code>
in your application, drag a <span class="application">NetPositive</span>
Replicant into it, and dump out the resulting archive message. If you
hand-craft your own <span class="application">NetPositive</span> Replicant
archive, you can instantiate <span class="application">NetPositive</span>
Replicants in your application to do in-line <acronym class="acronym">HTML</acronym>
viewing. Since the <span class="application">NetPositive</span>-specific message
fields aren't documented anywhere else, here they are:
</p><ul class="itemizedlist"><li><p>
<code class="varname">url</code> (string)<br />
The fully-qualified <acronym class="acronym">URL</acronym> to open.
</p></li><li><p>
<code class="varname">encoding</code> (int32)<br />
The character encoding to use; see
<code class="filename">UTF8.h</code> for a list of constants.
</p></li><li><p>
<code class="varname">openAsText</code> (bool)<br />
<code class="constant">true</code> if <span class="application">NetPositive</span>
should open the URL as a plain text file.
</p></li><li><p>
<code class="varname">showToolbars</code> (bool)<br />
<code class="constant">true</code> if <span class="application">NetPositive</span>
should show the location field, navigation buttons,
and status bar.
</p></li></ul><p>
The other fields in the <code class="classname">BMessage</code> are inherited
from <code class="classname">BView</code>; disassemble
the Replicant archive to find out more.
</p></td></tr><tr class="question"><td><a id="id768113"></a><a id="id768116"></a>Q:</td><td><p>
Can I launch my own application when the user clicks a <code class="literal">telnet://</code> URL?
</p></td></tr><tr class="answer"><td align="left" valign="top">A:</td><td align="left" valign="top"><p>
This capability will be added for R4.1. It will be done through a set of
<acronym class="acronym">MIME</acronym> types that your application may register itself as
a handler of to receive notification when the user clicks on a specific
type of <acronym class="acronym">URL</acronym>. <span class="application">NetPositive</span> will
look for handlers for these <acronym class="acronym">MIME</acronym> types for all kinds of
<acronym class="acronym">URL</acronym>s that it doesn't insist on handling internally;
these include, telnet, news, <acronym class="acronym" title="Network News Transfer Protocol">NNTP</acronym>,
ftp, and more.
</p><p>
To help prevent user confusion, <span class="application">NetPositive</span> will always handle http,
file, javascript, and netpositive <acronym class="acronym">URL</acronym>s internally (when they are clicked
in <span class="application">NetPositive</span>, that is) and won't defer to external handlers. In
addition, if you're writing your own application that needs to deal with
<acronym class="acronym">URL</acronym>s (such as an e-mail program or word processor), you can use this
mechanism to launch the appropriate external handler for a <acronym class="acronym">URL</acronym>. See the
<code class="filename">TypeConstants.h</code> file in the R4.1 headers for more information.
</p></td></tr><tr class="question"><td><a id="id768196"></a><a id="id768199"></a>Q:</td><td><p>
Will you implement a "WWW Kit" for developers to use in their apps?
</p></td></tr><tr class="answer"><td align="left" valign="top">A:</td><td align="left" valign="top"><p>
This is a frequent and very reasonable request from developers. It
would be very handy if <span class="application">NetPositive</span>
exported its various functions into a
public Kit <acronym class="acronym">API</acronym> so developers could do things like instantiate (or
subclass) a <code class="classname">BHTMLView</code> in their application to show HTML or allow in-place
browsing, get files via <acronym class="acronym">HTTP</acronym>, and more. Some of these can be accomplished
now through the use of <span class="application">NetPositive</span> Replicants, but the mechanism is
clunky and the result difficult to control.
</p><p>
The browser components need to be worked into a stable public <acronym class="acronym">API</acronym> for
developers to be able to do these sorts of things better. While this is a
long-term goal for <span class="application">NetPositive</span>, there is an awful lot of heavy lifting in
the architecture that needs to happen for this to work well, or at all.
</p><p>
This is more than a convenient excuse: <span class="application">NetPositive</span> does indeed have an
<code class="classname">HTMLView</code> class, but trust me, you don't want to try to use it the way it
is now, because it is too inbred with the <acronym class="acronym">HTML</acronym> parser and <acronym class="acronym">HTTP</acronym> engine to
be usable to anyone else. The good news is that the architectural work
needed to make this a clean reality makes sense in many ways beyond a
public <acronym class="acronym">API</acronym>, so things are moving in the right direction. However, it will
be a while before we'll see the "WWW Kit" in the BeOS.
</p></td></tr></tbody></table></div></div><hr class="pagebreak" /><div class="sect1"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="DevWorkshop4-9"></a>Developers' Workshop: ParameterWebs and Nodes and Controls, Oh My!</h2></div><div xmlns:d="http://docbook.org/ns/docbook"><span xmlns="http://www.w3.org/1999/xhtml" class="author">By <span class="firstname">Christopher</span> <span class="surname">Tate</span></span></div></div></div><p>
I'm sure you've all noticed a certain emphasis on the Media Kit in
Developer Workshop columns over the last few months. So far we've talked
a lot about nodes, but not much about how to control their behavior from
the application level. Many commonplace nodes that media applications
will deal with on a regular basis have various parameters that can be
adjusted at run time. This week I'll show you how to present a user
interface for dynamically controlling a node.
</p><p>
But...before you run off to try the techniques I'll demonstrate here, I
must warn you that like so many of our new Media Kit tools, today's code
will only work under Release 4.1, not under Release 4. Feel free to
follow along at home, though, and as soon as you get your hands on
Release 4.1 you can see the glorious results in living color!
</p><p>
Right—the code. You can find the
<span class="application">ParameterSample</span> application right
here:
</p><p>
ftp://ftp.be.com/pub/samples/media_kit/ParameterSample.zip
</p><p>
This little application displays a pair of windows. One is a duplicate of
the Audio preferences panel's Mixer tab, and the other contains a single
slider control for adjusting the master gain of the system mixer. All the
controls are "live"; adjusting the sliders while sounds are playing
adjusts the volume in real time. And the secret to all this live
instrumentation is the magic of <code class="classname">BParameters</code>.
</p><div class="sect2"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="id768365"></a>What a Tangled Web We Weave</h3></div></div></div><p>
Any Media Kit node that has an adjustable configuration can express that
configuration in terms of <code class="classname">BParameter</code>s, objects which
each describe a single variable parameter. The set of all
<code class="classname">BParameter</code>s that a node supports is called its
"parameter web," and (sensibly enough) is published via a class
called <code class="classname">BParameterWeb</code>. Each
<code class="classname">BControllable</code> node in the system has exactly one
<code class="classname">BParameterWeb</code>; if a node is not configurable, its
<code class="classname">BParameterWeb</code> will contain no
<code class="classname">BParameter</code>s. You can see whether a given node is
controllable by checking (<code class="code"><span class="type">media_node</span>::<code class="varname">kind</code> &amp;
<code class="constant">B_CONTROLLABLE</code></code>), which will be non-zero if the
node is controllable.
</p><p>
The <code class="classname">BParameterWeb</code> is not simply a list of
<code class="classname">BParameters</code>. Because some parameters are linked --
for example, the gain and mute controls for a particular audio channel --
the <code class="classname">BParameterWeb</code> class uses a hierarchical
organization in which <code class="classname">BParameter</code>s are contained by
<code class="classname">BParameterGroup</code>s, which themselves can contain other
<code class="classname">BParameterGroup</code>s; the end result is rather like an
organization of files into a directory structure. This organization of
parameters into groups is intended as a "hint" to the user
interface to guide the presentation of related parameters.
</p></div><div class="sect2"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="id768456"></a>Ready-Made User Interface: Media Themes</h3></div></div></div><p>
The Media Kit also supports standardized presentations of media-related
controls. This ensures that all media-related instrumentation the user
sees will have a consistent look and feel. The Kit uses an object called
a <code class="classname">BMediaTheme</code> to manage the creation of
appropriate <code class="classname">BControl</code> objects for
configuring nodes. The design of <code class="classname">BMediaTheme</code>s is a topic for the future;
for today, we'll just use the default theme to get the controls for our
node.
</p><p>
Oh—our node? That's true, we need to pick a node to control,
preferably one that does something noticeable. The <span class="application">ParameterSample</span> app
manipulates the global system mixer's node, just like the Audio
preferences panel.
</p></div><div class="sect2"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="id768496"></a>BParameters the Easy Way</h3></div></div></div><p>
The easiest way to present a UI for a node's parameter web is to ask a
<code class="classname">BMediaTheme</code> to build one for you. This is the approach implemented in the
<code class="classname">EasySampleWin</code> class. Let's look at the relevant code, all of which is in
the window's constructor.
</p><pre class="programlisting cpp">
<span class="type">media_node</span> <code class="varname">mixerNode</code>;
<code class="classname">BMediaRoster</code>* <code class="varname">roster</code> = <code class="classname">BMediaRoster</code>::<code class="methodname">Roster</code>();
<code class="varname">roster</code>-&gt;<code class="methodname">GetAudioMixer</code>(&amp;<code class="varname">mixerNode</code>);
<code class="varname">roster</code>-&gt;<code class="methodname">GetParameterWebFor</code>(<code class="varname">mixerNode</code>, &amp;<code class="varname">mParamWeb</code>);
</pre><p>
This is straightforward: We look up the global <code class="classname">BMediaRoster</code> object, ask
it for a reference to the global system mixer's node, then get a copy of
the node's <code class="classname">BParameterWeb</code>.
</p><pre class="programlisting cpp">
<code class="classname">BMediaTheme</code>* <code class="varname">theme</code> = <code class="classname">BMediaTheme</code>::<code class="methodname">PreferredTheme</code>();
<code class="classname">BView</code>* <code class="varname">paramView</code> = <code class="varname">theme</code>-&gt;<code class="methodname">ViewFor</code>(<code class="varname">mParamWeb</code>);
<code class="methodname">AddChild</code>(<code class="varname">paramView</code>);
</pre><p>
That's it! We ask for the preferred theme, then request a
<code class="classname">BView</code> from the <code class="classname">BMediaTheme</code>
that can manage the full <code class="classname">BParameterWeb</code>. Once this
view is added to the window, your application needn't do anything with it
-- all messages and parameter updating are handled internally to the
<code class="classname">BView</code>. As a user, you'll see that this window
contains a clone of the Audio preferences panel's mixer controls. This is
because—surprise!—the Audio preferences panel uses exactly this
technique to build its <code class="classname">BView</code>s.
</p></div><div class="sect2"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="id768662"></a>Finer Control—the Hard Way</h3></div></div></div><p>
But what if you don't want to instrument the entire
<code class="classname">BParameterWeb</code>? What if you only want to present a UI
for a single <code class="classname">BParameter</code>? Well, life gets a bit more
complex in that case. Instead of creating a <code class="classname">BView</code> to
handle a single parameter, a <code class="classname">BMediaTheme</code> will create
a single <code class="classname">BControl</code>. The responsibility for handling
that <code class="classname">BControl</code>'s placement belongs to your
application. More significantly, handling that control's *semantics* is
also the app's responsibility—the app must respond to and interpret the
<code class="classname">BControl</code>'s messages, and change the
<code class="classname">BParameter</code>'s value in response to those messages.
</p><p>
The <code class="classname">HarderSampleWin</code> class displays a window
containing just the master gain slider. Let's look at the differences from
the easy case. The constructor begins the same way, by looking up the
mixer's <code class="classname">BParameterWeb</code>, but then things get
complicated:
</p><pre class="programlisting cpp">
<span class="type">int32</span> <code class="varname">numParams</code> = <code class="varname">mParamWeb</code>-&gt;<code class="methodname">CountParameters</code>();
<code class="classname">BParameter</code>* <code class="varname">param</code> = <code class="constant">NULL</code>;
for (<span class="type">int32</span> <code class="varname">i</code> = 0; <code class="varname">i</code> &lt; <code class="varname">numParams</code>; <code class="varname">i</code>++) {
  <code class="classname">BParameter</code>* <code class="varname">p</code> = <code class="varname">mParamWeb</code>-&gt;<code class="methodname">ParameterAt</code>(<code class="varname">i</code>);
  if (!<code class="function">strcmp</code>(<code class="varname">p</code>-&gt;<code class="methodname">Kind</code>(), <code class="constant">B_MASTER_GAIN</code>)) {
    <code class="varname">param</code> = <code class="varname">p</code>;
    break;
  }
}

if (<code class="varname">param</code>-&gt;<code class="methodname">Type</code>() == <code class="classname">BParameter</code>::<code class="constant">B_CONTINUOUS_PARAMETER</code>) {
  <code class="varname">mGainParam</code> = dynamic_cast&lt;<code class="classname">BContinuousParameter</code>*&gt;(<code class="varname">param</code>);
}
</pre><p>
This searches the <code class="classname">BParameterWeb</code> for a specific
<code class="classname">BParameter</code>; in this case, the master gain parameter.
This is easy because there is only one such parameter in the mixer's web.
If you're looking for a particular <code class="classname">BParameter</code> from a
given parameter web, there are other mechanisms you can use to locate the
one you're interested in, such as looking at
<code class="classname">BParameter</code>::<code class="methodname">ID()</code> and matching that against the
source or destination ID supplied with your connection to the node.
</p><p>
Note the <code class="code">dynamic_cast</code>. In general, you won't know the derived
type of the <code class="classname">BParameter</code> that the web returns to you.
The <code class="classname">BParameter</code>::<code class="methodname">Type()</code> method gives you the
information you need to determine which derived class the object really is,
and, therefore, how to manipulate it. Our example is simplified by knowing
that the system mixer's master gain control is always a
<code class="classname">BContinuousParameter</code>, but it would be a
straightforward matter to write code to handle any of the
<code class="classname">BParameter</code> subclasses appropriately.
</p><p>
Once we've found the right <code class="classname">BParameter</code>, we need a control that is
appropriate for manipulating it:
</p><pre class="programlisting cpp">
<code class="classname">BMediaTheme</code>* <code class="varname">theme</code> = <code class="classname">BMediaTheme</code>::<code class="methodname">PreferredTheme</code>();
<code class="classname">BControl</code>* <code class="varname">control</code> = <code class="varname">theme</code>-&gt;<code class="methodname">MakeControlFor</code>(<code class="varname">mGainParam</code>);
<code class="varname">mGainControl</code> = dynamic_cast&lt;<code class="classname">BMultiChannelControl</code>*&gt;(<code class="varname">control</code>);
<code class="varname">mGainControl</code>-&gt;<code class="methodname">SetMessage</code>(new <code class="classname">BMessage</code>(<code class="varname">gControlMessage</code>));
</pre><p>
That gives us the control, and ensures that its value-changed messages have
a known "what" code for our message handler to recognize. Note
that the control is of type <code class="classname">BMultiChannelControl</code>.
This class is new in R4.1. As its name suggests, it provides an interface
for controlling arbitrarily many "channels" of data from within a
single <code class="classname">BControl</code>. In our case, it will hold two
channels of data, because the system mixer is stereo. Controls derived from
<code class="classname">BContinuousParameter</code> will generally be derived from
either <code class="classname">BSlider</code> or
<code class="classname">BMultiChannelControl</code>—a general-purpose
application will need to be able to handle all possibilities—but for
purposes of the example we assume that the control is a
<code class="classname">BMultiChannelControl</code>, because the system mixer is
stereo.
</p><p>
Now, before we're done constructing the view, a little math:
</p><pre class="programlisting cpp">
<span class="type">float</span> <code class="varname">paramMin</code> = <code class="varname">mGainParam</code>-&gt;<code class="methodname">MinValue</code>();
<span class="type">float</span> <code class="varname">paramMax</code> = <code class="varname">mGainParam</code>-&gt;<code class="methodname">MaxValue</code>();
<span class="type">int32</span> <code class="varname">controlMin</code>, <code class="varname">controlMax</code>;
<code class="varname">mGainControl</code>-&gt;<code class="methodname">GetLimitsFor</code>(0, &amp;<code class="varname">controlMin</code>, &amp;<code class="varname">controlMax</code>);
<code class="varname">mScale</code> = (<code class="varname">paramMax</code> - <code class="varname">paramMin</code>) / (<code class="varname">controlMax</code> - <code class="varname">controlMin</code>);
<code class="varname">mOffset</code> = <code class="varname">paramMax</code> - <code class="varname">mScale</code> * <code class="varname">controlMax</code>;
</pre><p>
The <code class="classname">BControl</code>'s range and the
<code class="classname">BParameter</code>'s are not necessarily the same,
but they *are* guaranteed to map linearly. This formula is the result of
a little linear algebra that lets us express the parameter's min and max
values as a linear function of the control's min and max values.
</p><p>
That's it for setting up the window; the rest of the magic happens in the
window's <code class="methodname">MessageReceived()</code> method. When the slider
is moved, the window receives messages with our designated "what"
code indicating the new value of all channels of data managed by that
<code class="classname">BMultiChannelControl</code>. The channel values are passed
in an array of <span class="type">int32</span>s called
<code class="varname">be:channel_value</code>. If the parameter is single-valued,
then there may only be the standard <code class="classname">BControl</code> data,
under the name <code class="varname">be:value</code>. A well-behaved application
should be prepared to handle either case:
</p><pre class="programlisting cpp">
<span class="type">int32</span> <code class="varname">chan1</code>, <code class="varname">chan2</code>;
<span class="type">status_t</span> <code class="varname">err</code> =
  <code class="varname">msg</code>-&gt;<code class="methodname">FindInt32</code>("be:channel_value", 0, &amp;<code class="varname">chan1</code>);

if (!<code class="varname">err</code>)
  <code class="varname">err</code> = <code class="varname">msg</code>-&gt;<code class="methodname">FindInt32</code>("be:channel_value", 1, &amp;<code class="varname">chan2</code>);
else {
  <code class="varname">err</code> = <code class="varname">msg</code>-&gt;<code class="methodname">FindInt32</code>("be:value", &amp;<code class="varname">chan1</code>);
  <code class="varname">chan2</code> = <code class="varname">chan1</code>;
}
</pre><p>
Next, we use the scaling factors that we calculated earlier to transform
the slider's values to the <code class="classname">BParameter</code>'s expected
range. <code class="classname">BParameter</code>s take
floating point values, by the way!
</p><pre class="programlisting cpp">
<span class="type">float</span> <code class="varname">chanData</code>[2];
<code class="varname">chanData</code>[0] = <code class="varname">mScale</code> * <code class="varname">chan1</code> + <code class="varname">mOffset</code>;
<code class="varname">chanData</code>[1] = <code class="varname">mScale</code> * <code class="varname">chan2</code> + <code class="varname">mOffset</code>;
</pre><p>
Finally, we're ready to set the parameter's new value. Like so many other
things in the Media Kit, setting a <code class="classname">BParameter</code>'s value takes a performance
time at which to apply the change. We want the change to be immediate, so
we look up the current time according to the node's time source, and set
the parameter:
</p><pre class="programlisting cpp">
<code class="classname">BTimeSource</code>* <code class="varname">timeSource</code>;
<code class="classname">BMediaRoster</code>* <code class="varname">roster</code> = <code class="classname">BMediaRoster</code>::<code class="methodname">Roster</code>();
<code class="varname">timeSource</code> = <code class="varname">roster</code>-&gt;<code class="methodname">MakeTimeSourceFor</code>(<code class="varname">mParamWeb</code>-&gt;<code class="methodname">Node</code>());
<span class="type">bigtime_t</span> <code class="varname">now</code> = <code class="varname">timeSource</code>-&gt;<code class="methodname">Now</code>();
<code class="varname">mGainParam</code>-&gt;<code class="methodname">SetValue</code>(&amp;<code class="varname">chanData</code>, <code class="function">sizeof</code>(<code class="varname">chanData</code>), <code class="varname">now</code>);
</pre><p>
Voilà! An active, effective slider controlling the master system gain
without benefit of the Audio preferences panel!
</p></div><div class="sect2"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h3 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="id769675"></a>What Now?</h3></div></div></div><p>
Well, okay, it's not the world's most practical application (although a
pop-up Replicant to tweak the master volume would be pretty handy), but
of course it's just a convenient controllable node to illustrate the
principles. Other nodes that media applications will find themselves
presenting interfaces for with may include video compression, audio
devices including multichannel cards, video capture, and so forth. Now as
soon as you get Release 4.1 you'll be all set to build the UI of
everyone's dreams!
</p><p>
There's more that could be done with these implementations, too. Neither
one of them watches the <code class="classname">BParameterWeb</code> to see if it changes, and so the
dynamic updates that you see in the Audio preferences panel won't appear
in these sample windows. Also, none of these views are "aware" of
parameter value changes that are made in other views—so if you adjust
the master gain in the Audio preferences panel, you won't see the sliders
move in the sample windows. Perhaps a future Developer Workshop will
address these additional features...
</p></div></div><hr class="pagebreak" /><div class="sect1"><div xmlns="" xmlns:d="http://docbook.org/ns/docbook" class="titlepage"><div><div xmlns:d="http://docbook.org/ns/docbook"><h2 xmlns="http://www.w3.org/1999/xhtml" class="title"><a id="Gassee4-9"></a>Is the Customer King?</h2></div><div xmlns:d="http://docbook.org/ns/docbook"><span xmlns="http://www.w3.org/1999/xhtml" class="author">By <span class="firstname">Jean-Louis</span> <span class="surname">Gassée</span></span></div></div></div><p>
One would hope to answer this question in the affirmative, but before I
elaborate, some follow-up to last week's column,
"<a class="xref" href="Issue4-8.html#Gassee4-8" title="A Crack in the Wall">A Crack in the Wall</a>,"
along with our thanks.
</p><p>
Our offer of free copies of the BeOS to OEMs willing to load our OS "at
the factory," on the hard disk of PCs they sell, got a tremendous
response. We appreciate the interest in our product and we intend to do
our best to honor the hospitality extended to us. Watch this space or,
more generally, www.be.com, for more details. For a number of contractual
reasons, this offer applies only in the US and Canada, not to other
countries in the Americas or in Asia. For Europe, please contact our VP
Europe, Jean Calmon, jcalmon@beeurope.com, for country-by- country
details.
</p><p>
As we collect data from the flow of responses, an interesting but not
unexpected picture emerges. The OEMs expressing interest are the ones who
cannot realistically be "fined" by Microsoft—that is, lose their
Windows rebate. If you pay the maximum OEM price for Windows, or close to
it, you won't be afraid to load Linux or the BeOS on your customers' hard
drives, especially if you don't have to account to Wall Street for your
actions.
</p><p>
If, on the other hand, your exposure is measured in millions of dollars
per quarter, and you are the CEO of a publicly traded company, you'll
load Windows and nothing but Windows on the PCs you sell. More precisely,
you might load Linux as the OS engine on hardware other than PC servers.
In any event, this represents only a preliminary look at the returns --
it's too early to draw definite conclusions.
</p><p>
Now, let's turn to the customer in the title of this column. We hear that
the Windows monopoly is good for customers—it's a standard, there's no
confusion, users can rely on a trusted foundation for their work, and so
on. But how can this be if there are so many obstacles placed in the way
of a customer's even seeing that (s)he has some (limited) choices?
</p><p>
I'll take one example of what I mean by choices. One overseas OEM
announced with great fanfare that it would offer some configurations in
its PC line with a dual-boot arrangement: Windows 98 for mainstream
applications and the BeOS for its natural media uses. Great—exactly
what we wanted—the specialized media OS peacefully coexisting with the
mainstream platform.
</p><p>
Well, not exactly. If you take the machine out of the box and boot it,
the BeOS is nowhere to be seen—the computer boots only Windows 98. If
you read the documentation carefully, you'll find out how to "unhide" the
BeOS. Then, through a complicated sequence, you'll finally get to the
dual-boot situation. Should the OEM be criticized for this state of
affairs? Again, not exactly. It appears that the fear of losing Windows
rebates intervened to prevent the customer from being offered a genuine
dual-boot system. In fact, as we verified for ourselves, the steps the
customer must perform are so complicated that it's much easier just to do
the simple partition and BeOS installation possible with our retail
product, complete with a BeOS Launcher icon on the Windows desktop.
</p><p>
Wouldn't one think that Microsoft behaves, in effect, as if the PC
belonged to it, rather than to the OEM or to the customer? It's is hard
to see how the customer and, more generally, the industry, benefit if one
company decides what's good for all, and what the customer should see or
not see.
</p></div></div><div id="footer"><hr /><div id="footerT">Prev: <a href="Issue4-8.html">Issue 4-8, February 24, 1999</a>  Up: <a href="volume4.html">Volume 4: 1999</a>  Next: <a href="Issue4-10.html">Issue 4-10, March 10, 1999</a> </div><div id="footerB"><div id="footerBL"><a href="Issue4-8.html" title="Issue 4-8, February 24, 1999"><img src="./images/navigation/prev.png" alt="Prev" /></a> <a href="volume4.html" title="Volume 4: 1999"><img src="./images/navigation/up.png" alt="Up" /></a> <a href="Issue4-10.html" title="Issue 4-10, March 10, 1999"><img src="./images/navigation/next.png" alt="Next" /></a></div><div id="footerBR"><div><a href="http://www.haiku-os.org"><img src="./images/People_24.png" alt="haiku-os.org" title="Visit The Haiku Website" /></a></div><div class="navighome" title="Home"><a accesskey="h" href="index.html"><img src="./images/navigation/home.png" alt="Home" /></a></div></div><div id="footerBC"><a href="http://www.access-company.com/home.html" title="ACCESS Co."><img alt="Access Company" src="./images/access_logo.png" /></a></div></div></div><div id="licenseFooter"><div id="licenseFooterBL"><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/" title="Creative Commons License"><img alt="Creative Commons License" style="border-width:0" src="https://licensebuttons.net/l/by-nc-nd/3.0/88x31.png" /></a></div><div id="licenseFooterBR"><a href="./LegalNotice.html">Legal Notice</a></div><div id="licenseFooterBC"><span id="licenseText">This work is licensed under a
          <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative
          Commons Attribution-Non commercial-No Derivative Works 3.0 License</a>.</span></div></div></body></html>
